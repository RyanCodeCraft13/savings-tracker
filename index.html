<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RN Multi-Bank Tracker V2</title>
<meta name="theme-color" content="#00c6ff">
<link rel="manifest" href="manifest.json">
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:'Segoe UI',sans-serif;background:#0f2027;color:#fff;margin:0;padding:15px;transition:.3s;}
body.light{background:#f2f2f2;color:#111;}
h1{margin-bottom:15px;}
.pin-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999;}
.pin-screen input{padding:10px;font-size:20px;width:100px;text-align:center;border-radius:10px;border:none;margin-bottom:15px;}
#bankCards{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;padding-bottom:15px;margin-bottom:15px;}
.bank-card{min-width:250px;height:160px;border-radius:20px;margin-right:15px;color:white;position:relative;flex-shrink:0;scroll-snap-align:start;perspective:1000px;cursor:pointer;}
.bank-card-inner{width:100%;height:100%;border-radius:20px;transition: transform 0.6s;transform-style: preserve-3d;padding:15px;display:flex;flex-direction:column;justify-content:space-between;box-shadow:0 10px 25px rgba(0,0,0,0.4);}
.bank-card.flipped .bank-card-inner{transform:rotateY(180deg);}
.bank-card-front,.bank-card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:20px;padding:15px;display:flex;flex-direction:column;justify-content:space-between;}
.bank-card-front{background:linear-gradient(135deg,#00c6ff,#0072ff);}
.bank-card-back{background:#333;transform:rotateY(180deg);color:#fff;}
.bank-card h2{margin:0;font-size:18px;}
.bank-card p{margin:5px 0;font-size:22px;font-weight:bold;}
.bank-card small{font-size:12px;opacity:.8;cursor:pointer;}
.progress{height:6px;background:rgba(255,255,255,.2);border-radius:6px;overflow:hidden;}
.progress div{height:6px;background:#fff;width:0%;border-radius:6px;transition:.5s;}
.card-back-content{margin-top:20px;font-size:14px;line-height:1.4;display:flex;flex-direction:column;align-items:center;justify-content:center;}
#transactionsModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;flex-direction:column;padding:20px;overflow-y:auto;z-index:1000;color:#fff;}
.transaction{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #555;}
.fab{position:fixed;bottom:20px;right:20px;background:#00c6ff;border-radius:50%;width:60px;height:60px;font-size:30px;color:#fff;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 5px 15px rgba(0,0,0,0.3);}
button,input,select,textarea{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:none;font-size:16px;}
button{background:#00c6ff;color:white;font-weight:bold;cursor:pointer;}
button:hover{opacity:.85;}
</style>
</head>
<body>

<!-- PIN Screen -->
<div id="pinScreen" class="pin-screen">
<h2>Enter PIN</h2>
<input id="pinInput" maxlength="4" type="password">
<button onclick="unlock()">Unlock</button>
<button onclick="changePIN()">Change PIN</button>
</div>

<h1>üè¶ RN Multi-Bank Tracker V2</h1>
<button onclick="toggleTheme()">Toggle Theme</button>

<div id="bankCards"></div>

<div id="transactionsModal">
<button onclick="closeTransactions()" style="margin-bottom:10px;">Close</button>
<h2>Transactions</h2>
<div id="modalTransactions"></div>
</div>

<div class="card">
<h3>Add Transaction</h3>
<select id="bank"><option>GCash</option><option>Maya</option><option>GoTyme</option><option>MariBank</option><option>BDO</option></select>
<input id="amount" type="number" placeholder="Amount">
<select id="type"><option value="deposit">Deposit</option><option value="withdraw">Withdraw</option><option value="transfer">Transfer</option></select>
<select id="transferBank"><option>GCash</option><option>Maya</option><option>GoTyme</option><option>MariBank</option><option>BDO</option></select>
<select id="category"><option>General</option><option>Food</option><option>Bills</option><option>Entertainment</option></select>
<textarea id="note" placeholder="Note"></textarea>
<button onclick="addTransaction()">Add</button>
<button onclick="exportCSV()">Export CSV</button>
</div>

<div class="card">
<h3>Savings Goals</h3>
<div id="goals"></div>
</div>

<div class="card">
<h3>Analytics</h3>
<canvas id="lineChart"></canvas>
<canvas id="pieChart"></canvas>
</div>

<div class="fab" onclick="scrollToTop()">+</div>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== PIN & Theme =====
let pin = localStorage.getItem("pin") || "1234";
let unlocked = false;
function unlock() {
  if (document.getElementById("pinInput").value === pin) {
    document.getElementById("pinScreen").style.display = "none";
    unlocked = true;
    render();
  } else alert("Wrong PIN");
}
function changePIN() {
  let newPin = prompt("Enter new PIN");
  if (newPin) { pin = newPin; localStorage.setItem("pin", pin); }
}
function toggleTheme() { document.body.classList.toggle("light"); }

// ===== Data =====
let banks = {}, goals = { GCash:5000, Maya:3000, GoTyme:4000, MariBank:6000, BDO:10000 }, transactions = [];

// ===== Firestore Listener =====
db.collection("transactions").orderBy("date").onSnapshot((snapshot)=>{
  banks={GCash:0,Maya:0,GoTyme:0,MariBank:0,BDO:0};
  transactions=[];
  snapshot.forEach(doc=>{
    let t=doc.data();
    let amt = parseFloat(t.amount);
    transactions.push(t);
    if(t.type==="deposit") banks[t.bank] += amt;
    if(t.type==="withdraw") banks[t.bank] -= amt;
    if(t.type==="transfer"){ banks[t.bank]-=amt; banks[t.transfer]+=amt; }
  });
  if(unlocked) render();
});

// ===== Add Transaction =====
const bankInput=document.getElementById("bank"),
      amountInput=document.getElementById("amount"),
      typeInput=document.getElementById("type"),
      transferBankInput=document.getElementById("transferBank"),
      categoryInput=document.getElementById("category"),
      noteInput=document.getElementById("note");

function addTransaction(){
  if(!unlocked) return alert("Unlock first");
  let bank = bankInput.value;
  let type = typeInput.value;
  let amount = parseFloat(amountInput.value);
  if(!amount) return alert("Enter valid amount");
  let transferBankValue = transferBankInput.value;
  let category = categoryInput.value;
  let note = noteInput.value;

  let t = {
    bank,
    type,
    amount,
    date: new Date().toISOString(),
    category,
    note,
    transfer: type==="transfer"?transferBankValue:null
  };

  db.collection("transactions").add(t);
  amountInput.value=""; noteInput.value="";
}

// ===== Render =====
function render() {
  if(!unlocked) return;
  const bankCards=document.getElementById("bankCards");
  bankCards.innerHTML="";
  for(let b in banks){
    let lastTx=transactions.filter(t=>t.bank===b).slice(-1)[0];
    let lastTxText=lastTx?`${lastTx.type} ‚Ç±${lastTx.amount}`:"No transactions";
    let percent=Math.min((banks[b]/goals[b])*100,100);
    let gradient="",logo="";
    switch(b){
      case "GCash":gradient="linear-gradient(135deg,#00ff99,#00cc77)";logo="üí∞";break;
      case "Maya":gradient="linear-gradient(135deg,#ffcc00,#ff9900)";logo="üü°";break;
      case "GoTyme":gradient="linear-gradient(135deg,#00c6ff,#0072ff)";logo="üåÄ";break;
      case "MariBank":gradient="linear-gradient(135deg,#ff66cc,#ff0066)";logo="üè¶";break;
      case "BDO":gradient="linear-gradient(135deg,#9933ff,#6600cc)";logo="üí≥";break;
    }
    bankCards.innerHTML+=`
    <div class="bank-card" onclick="flipCard(this)">
      <div class="bank-card-inner">
        <div class="bank-card-front" style="background:${gradient}">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>${b}</h2><span style="font-size:20px">${logo}</span>
          </div>
          <p>‚Ç±${banks[b]}</p>
          <div class="progress"><div style="width:${percent}%"></div></div>
          <small onclick="event.stopPropagation(); showTransactions('${b}')">Last: ${lastTxText}</small>
        </div>
        <div class="bank-card-back">
          <div class="card-back-content">
            <p id="cardNumber${b}">Card Number: **** **** **** ****</p>
            <p>Expiry: 12/30</p>
            <p>CVV: ***</p>
            <canvas id="qr${b}" width="80" height="80"></canvas>
          </div>
        </div>
      </div>
    </div>`;
  }
  renderCharts(); renderGoals();
}

// ===== Charts & Goals =====
function renderGoals() {
  let goalsDiv=document.getElementById("goals");
  goalsDiv.innerHTML="";
  for(let b in banks){
    let percent=Math.min((banks[b]/goals[b])*100,100);
    goalsDiv.innerHTML+=`<p>${b} ‚Ç±${banks[b]} / ‚Ç±${goals[b]}</p><div class="progress"><div style="width:${percent}%"></div></div>`;
  }
}

function renderCharts() {
  let ctx=document.getElementById("lineChart").getContext("2d");
  if(window.lineChartObj) window.lineChartObj.destroy();
  let runningBalance = [];
  let total=0;
  transactions.forEach(t=>{
    let amt = t.type==="deposit"?t.amount: t.type==="withdraw"?-t.amount:0;
    total+=amt;
    runningBalance.push(total);
  });
  window.lineChartObj=new Chart(ctx,{type:'line',data:{labels:transactions.map(t=>t.date),datasets:[{label:'Balance Change',data:runningBalance,borderColor:'#00c6ff',fill:false}]}});
  
  let pie=document.getElementById("pieChart").getContext("2d");
  if(window.pieChartObj) window.pieChartObj.destroy();
  let categoryTotals={};
  transactions.forEach(t=>categoryTotals[t.category]=(categoryTotals[t.category]||0)+t.amount);
  window.pieChartObj=new Chart(pie,{type:'pie',data:{labels:Object.keys(categoryTotals),datasets:[{data:Object.values(categoryTotals),backgroundColor:['#00c6ff','#ff7b00','#ff0044','#00ff88']]}}});
}

// ===== Other Functions =====
function flipCard(card){card.classList.toggle("flipped");}
function showTransactions(bank){
  const modal=document.getElementById("transactionsModal");
  const div=document.getElementById("modalTransactions");
  div.innerHTML="";
  transactions.filter(t=>t.bank===bank).forEach(t=>{
    div.innerHTML+=`<div class="transaction"><span>${t.date} - ${t.type}</span><span>‚Ç±${t.amount}</span></div>`;
  });
  modal.style.display="flex";
}
function closeTransactions(){document.getElementById("transactionsModal").style.display="none";}
function exportCSV(){
  let csv="Bank,Type,Amount,Date,Category,Note\n";
  transactions.forEach(t=>csv+=`${t.bank},${t.type},${t.amount},${t.date},${t.category},"${t.note}"\n`);
  let blob=new Blob([csv]);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="transactions.csv";
  a.click();
}
function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"});}

// ===== Service Worker (PWA) =====
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>
</body>
</html>
